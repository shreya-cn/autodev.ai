#!/usr/bin/env python3
"""
Git Hook for Jira Ticket Management - Post Commit
Updates ticket status and suggests related tickets using AI.
"""

import os
import sys
from pathlib import Path

# Get the directory containing this script
SCRIPT_DIR = Path(__file__).parent.absolute()

# Import the ticket manager
sys.path.insert(0, str(SCRIPT_DIR.parent))

try:
    from jira_ticket_manager import JiraTicketManager
    from ai_ticket_suggester import AITicketSuggester
    
    def update_ticket_and_suggest():
        """Update Jira ticket and suggest related tickets."""
        manager = JiraTicketManager()
        
        if not manager.validate_credentials():
            print("Warning: Could not connect to Jira")
            return
        
        # Update ticket status
        manager.auto_update_ticket()
        
        # Get current ticket
        branch = manager.get_current_branch()
        if branch:
            ticket_key = manager.extract_ticket_key(branch)
            if ticket_key:
                # Run AI suggestions in background (don't block commit)
                print("\nðŸ¤– Analyzing related tickets...")
                suggester = AITicketSuggester()
                suggester.suggest_related_tickets(ticket_key)
    
    if __name__ == "__main__":
        update_ticket_and_suggest()
        
except Exception as e:
    print(f"Warning: Ticket automation failed: {e}")
    pass
