{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/sharanr/Documents/Valtech/Others/AI-Hackathon/autodev.ai/autodev-ui/app/api/jira/related-tickets/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nexport async function GET() {\n  try {\n    // Get the current ticket from git branch and run AI suggester\n    const workspaceRoot = process.cwd().replace('/autodev-ui', '');\n    const { stdout } = await execAsync(\n      `cd \"${workspaceRoot}\" && python3 ai_ticket_suggester.py 2>&1`,\n      { \n        shell: '/bin/zsh',\n        env: { ...process.env }\n      }\n    );\n\n    // Parse the output to extract related tickets\n    // The Python script outputs JSON or structured text\n    const lines = stdout.split('\\n');\n    const tickets: any[] = [];\n    let currentTicket = '';\n\n    // Extract current ticket and suggestions from output\n    lines.forEach(line => {\n      if (line.includes('Current:')) {\n        currentTicket = line.split(':')[1]?.trim() || '';\n      }\n      // Parse ticket information from output\n      const ticketMatch = line.match(/(\\w+-\\d+)\\s+-\\s+(.+?)\\s+\\((\\d+)%\\s+match\\)/);\n      if (ticketMatch) {\n        tickets.push({\n          key: ticketMatch[1],\n          summary: ticketMatch[2],\n          score: parseInt(ticketMatch[3]),\n          status: 'Unknown',\n          reason: 'Related to current work',\n        });\n      }\n    });\n\n    return NextResponse.json({ tickets, currentTicket });\n  } catch (error) {\n    console.error('Error fetching related tickets:', error);\n    \n    // Return mock data\n    return NextResponse.json({\n      tickets: [\n        {\n          key: 'KAN-6',\n          summary: 'Add filter to users-list table',\n          status: 'To Do',\n          score: 100,\n          reason: 'Add filter option to users-list table',\n        },\n        {\n          key: 'KAN-5',\n          summary: 'Change table header',\n          status: 'To Do',\n          score: 100,\n          reason: 'Add a new column in the users-list table. The column name should be \"Address\"',\n        },\n        {\n          key: 'KAN-8',\n          summary: 'Outdated npm dependencies detected',\n          status: 'To Do',\n          score: 100,\n          reason: 'Limited support for React hooks, which restricts the ability to manage routing state',\n        },\n      ],\n      currentTicket: 'KAN-4',\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,YAAY,IAAA,8GAAS,EAAC,2HAAI;AAEzB,eAAe;IACpB,IAAI;QACF,8DAA8D;QAC9D,MAAM,gBAAgB,QAAQ,GAAG,GAAG,OAAO,CAAC,eAAe;QAC3D,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,UACvB,CAAC,IAAI,EAAE,cAAc,wCAAwC,CAAC,EAC9D;YACE,OAAO;YACP,KAAK;gBAAE,GAAG,QAAQ,GAAG;YAAC;QACxB;QAGF,8CAA8C;QAC9C,oDAAoD;QACpD,MAAM,QAAQ,OAAO,KAAK,CAAC;QAC3B,MAAM,UAAiB,EAAE;QACzB,IAAI,gBAAgB;QAEpB,qDAAqD;QACrD,MAAM,OAAO,CAAC,CAAA;YACZ,IAAI,KAAK,QAAQ,CAAC,aAAa;gBAC7B,gBAAgB,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,UAAU;YAChD;YACA,uCAAuC;YACvC,MAAM,cAAc,KAAK,KAAK,CAAC;YAC/B,IAAI,aAAa;gBACf,QAAQ,IAAI,CAAC;oBACX,KAAK,WAAW,CAAC,EAAE;oBACnB,SAAS,WAAW,CAAC,EAAE;oBACvB,OAAO,SAAS,WAAW,CAAC,EAAE;oBAC9B,QAAQ;oBACR,QAAQ;gBACV;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAS;QAAc;IACpD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QAEjD,mBAAmB;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;gBACP;oBACE,KAAK;oBACL,SAAS;oBACT,QAAQ;oBACR,OAAO;oBACP,QAAQ;gBACV;gBACA;oBACE,KAAK;oBACL,SAAS;oBACT,QAAQ;oBACR,OAAO;oBACP,QAAQ;gBACV;gBACA;oBACE,KAAK;oBACL,SAAS;oBACT,QAAQ;oBACR,OAAO;oBACP,QAAQ;gBACV;aACD;YACD,eAAe;QACjB;IACF;AACF"}}]
}