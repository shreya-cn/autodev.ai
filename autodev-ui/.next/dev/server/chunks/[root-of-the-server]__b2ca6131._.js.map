{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/sharanr/Documents/Valtech/Others/AI-Hackathon/autodev.ai/autodev-ui/app/api/jira/board/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\ninterface Ticket {\n  id: string;\n  key: string;\n  summary: string;\n  status: string;\n  assignee: string;\n  priority: string;\n  type?: string;\n  updated?: string;\n  created?: string;\n}\n\ninterface Column {\n  id: string;\n  name: string;\n  tickets: Ticket[];\n}\n\nexport async function GET() {\n  try {\n    // Call the Python script to get Jira board data\n    const workspaceRoot = process.cwd().replace('/autodev-ui', '');\n    const { stdout, stderr } = await execAsync(\n      `cd \"${workspaceRoot}\" && python3 -c \"from jira_ticket_manager import JiraTicketManager; import json; manager = JiraTicketManager(); tickets = manager.get_all_open_tickets(); print(json.dumps({'tickets': tickets}))\"`,\n      { \n        shell: '/bin/zsh',\n        env: { ...process.env },\n        timeout: 10000 // 10 second timeout\n      }\n    );\n\n    if (stderr && !stderr.includes('âœ“')) {\n      console.error('Python script error:', stderr);\n    }\n\n    const data = JSON.parse(stdout.trim());\n    \n    // Organize tickets by status\n    const columns: Column[] = [\n      { id: 'todo', name: 'To Do', tickets: [] },\n      { id: 'inprogress', name: 'In Progress', tickets: [] },\n      { id: 'review', name: 'Review', tickets: [] },\n      { id: 'done', name: 'Done', tickets: [] },\n    ];\n\n    // Distribute tickets into columns based on status\n    if (data.tickets && Array.isArray(data.tickets)) {\n      data.tickets.forEach((ticket: Ticket) => {\n        const status = ticket.status?.toLowerCase() || '';\n        \n        if (status.includes('to do') || status.includes('todo') || status.includes('backlog')) {\n          columns[0].tickets.push(ticket);\n        } else if (status.includes('in progress') || status.includes('progress')) {\n          columns[1].tickets.push(ticket);\n        } else if (status.includes('review') || status.includes('code review')) {\n          columns[2].tickets.push(ticket);\n        } else if (status.includes('done') || status.includes('closed') || status.includes('resolved')) {\n          columns[3].tickets.push(ticket);\n        } else {\n          columns[0].tickets.push(ticket); // Default to To Do\n        }\n      });\n    }\n\n    return NextResponse.json({ columns });\n  } catch (error) {\n    console.error('Error fetching Jira board:', error);\n    \n    // Return empty columns with error message\n    return NextResponse.json({\n      error: 'Failed to fetch Jira tickets. Please check your Jira credentials in .env.local',\n      columns: [\n        {\n          id: 'todo',\n          name: 'To Do',\n          tickets: [],\n        },\n        {\n          id: 'inprogress',\n          name: 'In Progress',\n          tickets: [],\n        },\n        {\n          id: 'review',\n          name: 'Review',\n          tickets: [],\n        },\n        {\n          id: 'done',\n          name: 'Done',\n          tickets: [],\n        },\n      ],\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,YAAY,IAAA,8GAAS,EAAC,2HAAI;AAoBzB,eAAe;IACpB,IAAI;QACF,gDAAgD;QAChD,MAAM,gBAAgB,QAAQ,GAAG,GAAG,OAAO,CAAC,eAAe;QAC3D,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,UAC/B,CAAC,IAAI,EAAE,cAAc,kMAAkM,CAAC,EACxN;YACE,OAAO;YACP,KAAK;gBAAE,GAAG,QAAQ,GAAG;YAAC;YACtB,SAAS,MAAM,oBAAoB;QACrC;QAGF,IAAI,UAAU,CAAC,OAAO,QAAQ,CAAC,MAAM;YACnC,QAAQ,KAAK,CAAC,wBAAwB;QACxC;QAEA,MAAM,OAAO,KAAK,KAAK,CAAC,OAAO,IAAI;QAEnC,6BAA6B;QAC7B,MAAM,UAAoB;YACxB;gBAAE,IAAI;gBAAQ,MAAM;gBAAS,SAAS,EAAE;YAAC;YACzC;gBAAE,IAAI;gBAAc,MAAM;gBAAe,SAAS,EAAE;YAAC;YACrD;gBAAE,IAAI;gBAAU,MAAM;gBAAU,SAAS,EAAE;YAAC;YAC5C;gBAAE,IAAI;gBAAQ,MAAM;gBAAQ,SAAS,EAAE;YAAC;SACzC;QAED,kDAAkD;QAClD,IAAI,KAAK,OAAO,IAAI,MAAM,OAAO,CAAC,KAAK,OAAO,GAAG;YAC/C,KAAK,OAAO,CAAC,OAAO,CAAC,CAAC;gBACpB,MAAM,SAAS,OAAO,MAAM,EAAE,iBAAiB;gBAE/C,IAAI,OAAO,QAAQ,CAAC,YAAY,OAAO,QAAQ,CAAC,WAAW,OAAO,QAAQ,CAAC,YAAY;oBACrF,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC;gBAC1B,OAAO,IAAI,OAAO,QAAQ,CAAC,kBAAkB,OAAO,QAAQ,CAAC,aAAa;oBACxE,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC;gBAC1B,OAAO,IAAI,OAAO,QAAQ,CAAC,aAAa,OAAO,QAAQ,CAAC,gBAAgB;oBACtE,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC;gBAC1B,OAAO,IAAI,OAAO,QAAQ,CAAC,WAAW,OAAO,QAAQ,CAAC,aAAa,OAAO,QAAQ,CAAC,aAAa;oBAC9F,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC;gBAC1B,OAAO;oBACL,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,mBAAmB;gBACtD;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAE5C,0CAA0C;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,SAAS;gBACP;oBACE,IAAI;oBACJ,MAAM;oBACN,SAAS,EAAE;gBACb;gBACA;oBACE,IAAI;oBACJ,MAAM;oBACN,SAAS,EAAE;gBACb;gBACA;oBACE,IAAI;oBACJ,MAAM;oBACN,SAAS,EAAE;gBACb;gBACA;oBACE,IAAI;oBACJ,MAAM;oBACN,SAAS,EAAE;gBACb;aACD;QACH;IACF;AACF"}}]
}