{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/sharanr/Documents/Valtech/Others/AI-Hackathon/autodev.ai/autodev-ui/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth from \"next-auth\"\nimport type { NextAuthOptions } from \"next-auth\"\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    {\n      id: \"atlassian\",\n      name: \"Atlassian\",\n      type: \"oauth\",\n      authorization: {\n        url: \"https://auth.atlassian.com/authorize\",\n        params: {\n          audience: \"api.atlassian.com\",\n          prompt: \"consent\",\n          scope: \"read:me read:account offline_access read:jira-work read:jira-user read:confluence-content.all read:confluence-user\"\n        }\n      },\n      token: \"https://auth.atlassian.com/oauth/token\",\n      userinfo: {\n        url: \"https://api.atlassian.com/me\",\n        async request({ tokens }) {\n          console.log('Fetching user info with token:', tokens.access_token?.substring(0, 20) + '...')\n          const res = await fetch(\"https://api.atlassian.com/me\", {\n            headers: {\n              Authorization: `Bearer ${tokens.access_token}`,\n            },\n          })\n          const data = await res.json()\n          console.log('User info response:', data)\n          return data\n        }\n      },\n      profile(profile) {\n        return {\n          id: profile.account_id,\n          name: profile.name,\n          email: profile.email,\n          image: profile.picture\n        }\n      },\n      clientId: process.env.ATLASSIAN_CLIENT_ID,\n      clientSecret: process.env.ATLASSIAN_CLIENT_SECRET,\n    }\n  ],\n  callbacks: {\n    async jwt({ token, account, profile }) {\n      console.log('JWT Callback - Account:', account)\n      console.log('JWT Callback - Profile:', profile)\n      console.log('JWT Callback - Token before:', token)\n      \n      if (account) {\n        token.accessToken = account.access_token\n        token.refreshToken = account.refresh_token\n        token.accessTokenExpires = account.expires_at ? account.expires_at * 1000 : Date.now() + 10 * 60 * 60 * 1000 // 10 hours\n      }\n      if (profile) {\n        token.name = profile.name\n        token.email = profile.email\n        token.picture = profile.picture\n      }\n      \n      console.log('JWT Callback - Token after:', token)\n      return token\n    },\n    async session({ session, token }) {\n      console.log('Session Callback - Token:', token)\n      console.log('Session Callback - Session before:', session)\n      \n      session.accessToken = token.accessToken as string\n      session.user = {\n        name: token.name as string,\n        email: token.email as string,\n        image: token.picture as string,\n      }\n      \n      console.log('Session Callback - Session after:', session)\n      return session\n    }\n  },\n  pages: {\n    signIn: '/login',\n    signOut: '/signout',\n    error: '/login', // Redirect to login page on error\n  },\n  session: {\n    strategy: \"jwt\",\n    maxAge: 10 * 60 * 60, // 10 hours in seconds\n  },\n  debug: true, // Enable debug mode to see detailed error logs\n}\n\nconst handler = NextAuth(authOptions)\nexport { handler as GET, handler as POST }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGO,MAAM,cAA+B;IAC1C,WAAW;QACT;YACE,IAAI;YACJ,MAAM;YACN,MAAM;YACN,eAAe;gBACb,KAAK;gBACL,QAAQ;oBACN,UAAU;oBACV,QAAQ;oBACR,OAAO;gBACT;YACF;YACA,OAAO;YACP,UAAU;gBACR,KAAK;gBACL,MAAM,SAAQ,EAAE,MAAM,EAAE;oBACtB,QAAQ,GAAG,CAAC,kCAAkC,OAAO,YAAY,EAAE,UAAU,GAAG,MAAM;oBACtF,MAAM,MAAM,MAAM,MAAM,gCAAgC;wBACtD,SAAS;4BACP,eAAe,CAAC,OAAO,EAAE,OAAO,YAAY,EAAE;wBAChD;oBACF;oBACA,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,QAAQ,GAAG,CAAC,uBAAuB;oBACnC,OAAO;gBACT;YACF;YACA,SAAQ,OAAO;gBACb,OAAO;oBACL,IAAI,QAAQ,UAAU;oBACtB,MAAM,QAAQ,IAAI;oBAClB,OAAO,QAAQ,KAAK;oBACpB,OAAO,QAAQ,OAAO;gBACxB;YACF;YACA,UAAU,QAAQ,GAAG,CAAC,mBAAmB;YACzC,cAAc,QAAQ,GAAG,CAAC,uBAAuB;QACnD;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE;YACnC,QAAQ,GAAG,CAAC,2BAA2B;YACvC,QAAQ,GAAG,CAAC,2BAA2B;YACvC,QAAQ,GAAG,CAAC,gCAAgC;YAE5C,IAAI,SAAS;gBACX,MAAM,WAAW,GAAG,QAAQ,YAAY;gBACxC,MAAM,YAAY,GAAG,QAAQ,aAAa;gBAC1C,MAAM,kBAAkB,GAAG,QAAQ,UAAU,GAAG,QAAQ,UAAU,GAAG,OAAO,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,MAAK,WAAW;YAC1H;YACA,IAAI,SAAS;gBACX,MAAM,IAAI,GAAG,QAAQ,IAAI;gBACzB,MAAM,KAAK,GAAG,QAAQ,KAAK;gBAC3B,MAAM,OAAO,GAAG,QAAQ,OAAO;YACjC;YAEA,QAAQ,GAAG,CAAC,+BAA+B;YAC3C,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,QAAQ,GAAG,CAAC,6BAA6B;YACzC,QAAQ,GAAG,CAAC,sCAAsC;YAElD,QAAQ,WAAW,GAAG,MAAM,WAAW;YACvC,QAAQ,IAAI,GAAG;gBACb,MAAM,MAAM,IAAI;gBAChB,OAAO,MAAM,KAAK;gBAClB,OAAO,MAAM,OAAO;YACtB;YAEA,QAAQ,GAAG,CAAC,qCAAqC;YACjD,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;QACR,SAAS;QACT,OAAO;IACT;IACA,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK;IACpB;IACA,OAAO;AACT;AAEA,MAAM,UAAU,IAAA,kJAAQ,EAAC"}}]
}