{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/sharanr/Documents/Valtech/Others/AI-Hackathon/autodev.ai/autodev-ui/app/api/documentation/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { readdir, readFile } from 'fs/promises';\nimport { join } from 'path';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\ninterface DocumentationItem {\n  service: string;\n  title: string;\n  content: string;\n  type: string;\n  lastModified?: string;\n  pageUrl?: string;\n}\n\ninterface ConfluencePage {\n  id: string;\n  title: string;\n  url: string;\n  lastModified?: string;\n}\n\nexport async function GET() {\n  try {\n    const workspaceRoot = process.cwd().replace('/autodev-ui', '');\n    \n    const microservices = [\n      'identityprovider',\n      'enrollment',\n      'usermanagement',\n      'vehiclemanagement'\n    ];\n\n    const documentation: DocumentationItem[] = [];\n    \n    // Get Confluence pages\n    let confluencePages: ConfluencePage[] = [];\n    try {\n      const { stdout } = await execAsync(`python3 ${workspaceRoot}/get_confluence_pages.py`);\n      confluencePages = JSON.parse(stdout);\n    } catch (error) {\n      console.error('Error fetching Confluence pages:', error);\n    }\n\n    // Read documentation from each microservice\n    for (const service of microservices) {\n      const docDir = join(workspaceRoot, service, 'documentation');\n      \n      try {\n        const files = await readdir(docDir);\n        \n        for (const file of files) {\n          if (file.endsWith('.adoc') || file.endsWith('.md')) {\n            const filePath = join(docDir, file);\n            const content = await readFile(filePath, 'utf-8');\n            const stats = await readFile(filePath, 'utf-8');\n            \n            // Extract title from filename\n            const title = file\n              .replace(/\\.(adoc|md)$/, '')\n              .split(/(?=[A-Z])/)\n              .join(' ')\n              .replace(/^./, str => str.toUpperCase());\n\n            // Try to match with Confluence page\n            // Confluence pages are titled like \"Openapispecification - Usermanagement\"\n            const fileNameWithoutExt = file.replace(/\\.(adoc|md)$/, '');\n            const serviceCapitalized = service.charAt(0).toUpperCase() + service.slice(1);\n            const expectedPageTitle = `${fileNameWithoutExt.charAt(0).toUpperCase() + fileNameWithoutExt.slice(1)} - ${serviceCapitalized}`;\n            \n            const matchingPage = confluencePages.find(p => \n              p.title.toLowerCase() === expectedPageTitle.toLowerCase()\n            );\n\n            documentation.push({\n              service,\n              title,\n              content: content.substring(0, 500), // Preview only\n              type: file.endsWith('.adoc') ? 'asciidoc' : 'markdown',\n              lastModified: matchingPage?.lastModified || new Date().toISOString(),\n              pageUrl: matchingPage?.url\n            });\n          }\n        }\n      } catch (error) {\n        console.error(`Error reading documentation for ${service}:`, error);\n      }\n    }\n\n    // Get Confluence configuration\n    const confluenceConfig = {\n      url: process.env.CONFLUENCE_URL || 'https://autodev-ai.atlassian.net',\n      spaceKey: process.env.SPACE_KEY || '~712020a1106f7965b7429fa169a05d4788f4d5',\n      user: process.env.CONFLUENCE_USER || 'sharan99r@gmail.com'\n    };\n\n    return NextResponse.json({\n      documentation,\n      confluenceConfig,\n      microservices\n    });\n  } catch (error) {\n    console.error('Error fetching documentation:', error);\n    return NextResponse.json({\n      error: 'Failed to fetch documentation',\n      documentation: [],\n      confluenceConfig: {\n        url: 'https://autodev-ai.atlassian.net',\n        spaceKey: '~712020a1106f7965b7429fa169a05d4788f4d5',\n        user: 'sharan99r@gmail.com'\n      },\n      microservices: ['identityprovider', 'enrollment', 'usermanagement', 'vehiclemanagement']\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,MAAM,YAAY,IAAA,8GAAS,EAAC,2HAAI;AAkBzB,eAAe;IACpB,IAAI;QACF,MAAM,gBAAgB,QAAQ,GAAG,GAAG,OAAO,CAAC,eAAe;QAE3D,MAAM,gBAAgB;YACpB;YACA;YACA;YACA;SACD;QAED,MAAM,gBAAqC,EAAE;QAE7C,uBAAuB;QACvB,IAAI,kBAAoC,EAAE;QAC1C,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,UAAU,CAAC,QAAQ,EAAE,cAAc,wBAAwB,CAAC;YACrF,kBAAkB,KAAK,KAAK,CAAC;QAC/B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,oCAAoC;QACpD;QAEA,4CAA4C;QAC5C,KAAK,MAAM,WAAW,cAAe;YACnC,MAAM,SAAS,IAAA,yGAAI,EAAC,eAAe,SAAS;YAE5C,IAAI;gBACF,MAAM,QAAQ,MAAM,IAAA,gIAAO,EAAC;gBAE5B,KAAK,MAAM,QAAQ,MAAO;oBACxB,IAAI,KAAK,QAAQ,CAAC,YAAY,KAAK,QAAQ,CAAC,QAAQ;wBAClD,MAAM,WAAW,IAAA,yGAAI,EAAC,QAAQ;wBAC9B,MAAM,UAAU,MAAM,IAAA,iIAAQ,EAAC,UAAU;wBACzC,MAAM,QAAQ,MAAM,IAAA,iIAAQ,EAAC,UAAU;wBAEvC,8BAA8B;wBAC9B,MAAM,QAAQ,KACX,OAAO,CAAC,gBAAgB,IACxB,KAAK,CAAC,aACN,IAAI,CAAC,KACL,OAAO,CAAC,MAAM,CAAA,MAAO,IAAI,WAAW;wBAEvC,oCAAoC;wBACpC,2EAA2E;wBAC3E,MAAM,qBAAqB,KAAK,OAAO,CAAC,gBAAgB;wBACxD,MAAM,qBAAqB,QAAQ,MAAM,CAAC,GAAG,WAAW,KAAK,QAAQ,KAAK,CAAC;wBAC3E,MAAM,oBAAoB,GAAG,mBAAmB,MAAM,CAAC,GAAG,WAAW,KAAK,mBAAmB,KAAK,CAAC,GAAG,GAAG,EAAE,oBAAoB;wBAE/H,MAAM,eAAe,gBAAgB,IAAI,CAAC,CAAA,IACxC,EAAE,KAAK,CAAC,WAAW,OAAO,kBAAkB,WAAW;wBAGzD,cAAc,IAAI,CAAC;4BACjB;4BACA;4BACA,SAAS,QAAQ,SAAS,CAAC,GAAG;4BAC9B,MAAM,KAAK,QAAQ,CAAC,WAAW,aAAa;4BAC5C,cAAc,cAAc,gBAAgB,IAAI,OAAO,WAAW;4BAClE,SAAS,cAAc;wBACzB;oBACF;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,QAAQ,CAAC,CAAC,EAAE;YAC/D;QACF;QAEA,+BAA+B;QAC/B,MAAM,mBAAmB;YACvB,KAAK,QAAQ,GAAG,CAAC,cAAc,IAAI;YACnC,UAAU,QAAQ,GAAG,CAAC,SAAS,IAAI;YACnC,MAAM,QAAQ,GAAG,CAAC,eAAe,IAAI;QACvC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,eAAe,EAAE;YACjB,kBAAkB;gBAChB,KAAK;gBACL,UAAU;gBACV,MAAM;YACR;YACA,eAAe;gBAAC;gBAAoB;gBAAc;gBAAkB;aAAoB;QAC1F;IACF;AACF"}}]
}